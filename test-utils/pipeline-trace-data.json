{
  "metadata": {
    "generated": "2026-02-09",
    "pipelines": 15,
    "databases": 5,
    "status": {
      "INTACT": 6,
      "DEGRADED": 6,
      "DEAD_CODE": 1,
      "BROKEN": 1,
      "INTACT_WITH_ORPHAN": 1
    }
  },
  "databases": [
    {
      "name": "kbl-league-builder",
      "stores": ["leagueTemplates", "globalTeams", "globalPlayers", "rulesPresets", "teamRosters"],
      "usedBy": "leagueBuilderStorage.ts"
    },
    {
      "name": "kbl-schedule",
      "stores": ["scheduledGames", "scheduleMetadata"],
      "usedBy": "scheduleStorage.ts"
    },
    {
      "name": "kbl-playoffs",
      "stores": ["playoffs", "series", "playoffGames", "playoffStats"],
      "usedBy": "playoffStorage.ts",
      "orphanedStores": ["playoffGames", "playoffStats"]
    },
    {
      "name": "kbl-tracker",
      "stores": ["completedGames", "playerSeasonBatting", "playerSeasonPitching", "playerSeasonFielding", "seasonMetadata", "gameHeaders", "atBatEvents", "careerBatting", "careerPitching", "careerMilestones"],
      "usedBy": "gameStorage.ts, seasonStorage.ts, eventLog.ts, careerStorage.ts"
    },
    {
      "name": "kbl-app-meta",
      "stores": ["franchiseList", "appSettings"],
      "usedBy": "franchiseManager.ts"
    }
  ],
  "pipelines": [
    {
      "id": "PL-01",
      "name": "Game Completion Entry",
      "status": "DEGRADED",
      "severity": "HIGH",
      "junctions": 2,
      "entryPoint": "useGameState.ts:endGame() line 2973",
      "exitPoint": "archiveCompletedGame() + aggregateGameToSeason()",
      "bugs": [
        {
          "id": "PL01-BUG-01",
          "description": "pitcherName set to pitcherId in completeGameInternal",
          "location": "useGameState.ts:2868",
          "impact": "Pitcher names show as IDs in season stats"
        },
        {
          "id": "PL01-BUG-02",
          "description": "Double archival (endGame + completeGameInternal)",
          "location": "useGameState.ts:3095 + 2963",
          "impact": "Wasteful; second overwrites first"
        },
        {
          "id": "PL01-BUG-03",
          "description": "Fielding stats hardcoded to 0",
          "location": "useGameState.ts:2841-2843",
          "impact": "Entire fielding pipeline is dead"
        },
        {
          "id": "PL01-BUG-04",
          "description": "basesReachedViaError always 0",
          "location": "useGameState.ts:2880",
          "impact": "Perfect game detection may be inaccurate"
        }
      ]
    },
    {
      "id": "PL-02",
      "name": "Season Batting Aggregation",
      "status": "INTACT",
      "severity": "LOW",
      "junctions": 6,
      "entryPoint": "seasonAggregator.ts:aggregateBattingStats() line 141",
      "exitPoint": "IndexedDB playerSeasonBatting store",
      "fieldMap": {
        "pa": "pa",
        "ab": "ab",
        "h": "hits",
        "singles": "singles",
        "doubles": "doubles",
        "triples": "triples",
        "hr": "homeRuns",
        "rbi": "rbi",
        "r": "runs",
        "bb": "walks",
        "k": "strikeouts",
        "sb": "stolenBases",
        "cs": "caughtStealing",
        "hbp": "hitByPitch"
      },
      "notAggregated": ["sacFlies", "sacBunts", "gidp"],
      "bugs": []
    },
    {
      "id": "PL-03",
      "name": "Season Pitching Aggregation",
      "status": "INTACT",
      "severity": "LOW",
      "junctions": 5,
      "entryPoint": "seasonAggregator.ts:aggregatePitchingStats() line 181",
      "exitPoint": "IndexedDB playerSeasonPitching store",
      "bugs": [],
      "notes": "balks field exists in season type but never written (SMB4 has no balks)"
    },
    {
      "id": "PL-04",
      "name": "Season Fielding Aggregation",
      "status": "DEAD_CODE",
      "severity": "HIGH",
      "junctions": 4,
      "entryPoint": "seasonAggregator.ts:aggregateFieldingStats() line 250",
      "exitPoint": "IndexedDB playerSeasonFielding store (always zeros)",
      "bugs": [
        {
          "id": "PL04-BUG-01",
          "description": "All fielding source data hardcoded to 0 upstream",
          "location": "useGameState.ts:2841-2843",
          "impact": "Entire fielding aggregation is dead code"
        }
      ]
    },
    {
      "id": "PL-05",
      "name": "Fame Event Aggregation",
      "status": "DEGRADED",
      "severity": "MED",
      "junctions": 4,
      "entryPoint": "seasonAggregator.ts:aggregateFameEvents() line 278",
      "exitPoint": "IndexedDB playerSeasonBatting.fameBonuses/fameBoners",
      "bugs": [
        {
          "id": "PL05-BUG-01",
          "description": "playerId used as playerName",
          "location": "seasonAggregator.ts:304",
          "impact": "Fame records show IDs not names"
        },
        {
          "id": "PL05-BUG-02",
          "description": "awayTeamId used for ALL players",
          "location": "seasonAggregator.ts:305",
          "impact": "Home team players assigned wrong team"
        }
      ]
    },
    {
      "id": "PL-06",
      "name": "Season Stats Retrieval & Display",
      "status": "DEGRADED",
      "severity": "MED",
      "junctions": 5,
      "entryPoint": "useSeasonStats hooks (base + figma)",
      "exitPoint": "FranchiseHome leaders, TeamHubContent, MuseumContent",
      "bugs": [
        {
          "id": "PL06-BUG-01",
          "description": "Figma useSeasonStats accesses b.totalWar, b.bwar, b.rwar, b.fwar — fields don't exist on PlayerSeasonBatting",
          "location": "src/src_figma/app/hooks/useSeasonStats.ts:130-134",
          "impact": "WAR always shows as 0 in TeamHub/Museum"
        },
        {
          "id": "PL06-BUG-02",
          "description": "seasonId default mismatch between write (season-1) and read (season-2024)",
          "location": "useGameState.ts:2952 vs useSeasonStats.ts:83",
          "impact": "Data written to one season ID may not be found by read hooks"
        }
      ]
    },
    {
      "id": "PL-07",
      "name": "WAR Calculation",
      "status": "INTACT",
      "severity": "MED",
      "junctions": 16,
      "entryPoint": "useWARCalculations hooks (legacy + figma)",
      "exitPoint": "WARDisplay, PlayerCard, SeasonSummary, TeamHubContent",
      "bugs": [
        {
          "id": "PL07-BUG-01",
          "description": "Figma convertBattingStats drops SB/CS (set to 0)",
          "location": "src/src_figma/app/hooks/useWARCalculations.ts:135-136",
          "impact": "rWAR always 0 in Figma UI"
        },
        {
          "id": "PL07-BUG-02",
          "description": "No fWAR exposed in Figma hook",
          "location": "src/src_figma/app/hooks/useWARCalculations.ts",
          "impact": "fWAR not calculable from Figma UI"
        },
        {
          "id": "PL07-BUG-03",
          "description": "Career WAR no idempotency guard",
          "location": "careerStorage.ts:947-950",
          "impact": "Double-count risk if aggregation runs twice"
        }
      ]
    },
    {
      "id": "PL-08",
      "name": "Milestone/Career Aggregation",
      "status": "INTACT",
      "severity": "MED",
      "junctions": 15,
      "entryPoint": "milestoneAggregator.ts:aggregateGameWithMilestones() line 698",
      "exitPoint": "IndexedDB careerMilestones + careerBatting/Pitching stores",
      "bugs": [
        {
          "id": "PL08-BUG-01",
          "description": "playerName = playerId (TODO comment)",
          "location": "milestoneAggregator.ts:722",
          "impact": "Milestone records show IDs"
        },
        {
          "id": "PL08-BUG-02",
          "description": "teamId = awayTeamId for all players",
          "location": "milestoneAggregator.ts:723",
          "impact": "All milestones attributed to away team"
        },
        {
          "id": "PL08-BUG-03",
          "description": "Career stat aggregation has no idempotency",
          "location": "milestoneAggregator.ts:79-134",
          "impact": "Stats double if same game processed twice"
        }
      ]
    },
    {
      "id": "PL-09",
      "name": "Event Log (Play-by-Play)",
      "status": "INTACT",
      "severity": "LOW",
      "junctions": 11,
      "entryPoint": "useGameState.ts logAtBatEvent calls",
      "exitPoint": "IndexedDB atBatEvents store",
      "bugs": [
        {
          "id": "PL09-BUG-01",
          "description": "generateBoxScore() is orphaned — nothing renders it",
          "location": "eventLog.ts:640",
          "impact": "Box score reconstruction exists but unused"
        },
        {
          "id": "PL09-BUG-02",
          "description": "Error count bug — both teams count ALL errors",
          "location": "eventLog.ts:723-724",
          "impact": "Box score errors incorrect if ever rendered"
        }
      ]
    },
    {
      "id": "PL-10",
      "name": "Fame System",
      "status": "INTACT",
      "severity": "LOW",
      "junctions": 15,
      "entryPoint": "useFameDetection + useFameTracking hooks",
      "exitPoint": "PersistedGameState.fameEvents[] + milestoneAggregator fameEvents[]",
      "formula": "fameValue = baseFame × sqrt(clamp(LI, 0.1, 10.0)) × playoffMultiplier",
      "bugs": [
        {
          "id": "PL10-BUG-01",
          "description": "Milestone fame events returned but only logged to console, not pushed to UI notifications",
          "location": "seasonAggregator.ts:96-103",
          "impact": "User never sees milestone-triggered fame events"
        }
      ]
    },
    {
      "id": "PL-11",
      "name": "League Builder CRUD",
      "status": "INTACT",
      "severity": "LOW",
      "junctions": 8,
      "entryPoint": "useLeagueBuilderData hook",
      "exitPoint": "IndexedDB kbl-league-builder stores",
      "bugs": [],
      "notes": "No cascade deletes. Full re-read on every write. Not optimistic updates."
    },
    {
      "id": "PL-12",
      "name": "Schedule Management",
      "status": "INTACT",
      "severity": "LOW",
      "junctions": 5,
      "entryPoint": "useScheduleData hook",
      "exitPoint": "IndexedDB kbl-schedule stores",
      "bugs": [],
      "notes": "updateMetadata is fire-and-forget. No FK link to leagueBuilder."
    },
    {
      "id": "PL-13",
      "name": "Standings Calculation",
      "status": "DEGRADED",
      "severity": "HIGH",
      "junctions": 4,
      "entryPoint": "calculateStandings() in seasonStorage.ts:784",
      "exitPoint": "useFranchiseData → FranchiseHome standings tab",
      "bugs": [
        {
          "id": "PL13-BUG-01",
          "description": "Reads from gameStorage completedGames, NOT scheduleStorage",
          "location": "seasonStorage.ts:787",
          "impact": "Two parallel game-result systems not connected"
        },
        {
          "id": "PL13-BUG-02",
          "description": "Naive division split (first half/second half of teams)",
          "location": "useFranchiseData.ts:378",
          "impact": "Ignores actual league structure from leagueBuilder"
        },
        {
          "id": "PL13-BUG-03",
          "description": "getRecentGames(500) limit",
          "location": "seasonStorage.ts:787",
          "impact": "Leagues with >500 total games get incomplete standings"
        },
        {
          "id": "PL13-BUG-04",
          "description": "No auto-refresh after game completion",
          "location": "useFranchiseData.ts",
          "impact": "Standings stale until FranchiseHome remounts"
        }
      ]
    },
    {
      "id": "PL-14",
      "name": "Playoff System",
      "status": "DEGRADED",
      "severity": "HIGH",
      "junctions": 7,
      "entryPoint": "usePlayoffData hook",
      "exitPoint": "FranchiseHome playoffs tab, WorldSeries page",
      "bugs": [
        {
          "id": "PL14-BUG-01",
          "description": "generateBracket only creates first-round series",
          "location": "playoffStorage.ts:475",
          "impact": "advanceRound would find no series for round 2+"
        },
        {
          "id": "PL14-BUG-02",
          "description": "playoffGames store never written to",
          "location": "playoffStorage.ts:212",
          "impact": "Orphaned store — games stored inside series.games[] instead"
        },
        {
          "id": "PL14-BUG-03",
          "description": "playoffStats store never written to",
          "location": "playoffStorage.ts",
          "impact": "No playoff player stat accumulation"
        },
        {
          "id": "PL14-BUG-04",
          "description": "playoffEngine.ts is orphaned from hook",
          "location": "playoffEngine.ts",
          "impact": "Sophisticated tiebreaker logic unused"
        }
      ]
    },
    {
      "id": "PL-15",
      "name": "Franchise State",
      "status": "DEGRADED",
      "severity": "HIGH",
      "junctions": 5,
      "entryPoint": "franchiseManager.ts + FranchiseSelector.tsx",
      "exitPoint": "useFranchiseData hook → FranchiseHome",
      "bugs": [
        {
          "id": "PL15-BUG-01",
          "description": "useFranchiseData always uses 'season-1' — ignores franchise context",
          "location": "useFranchiseData.ts:295",
          "impact": "Franchise isolation is meaningless"
        },
        {
          "id": "PL15-BUG-02",
          "description": "Per-franchise DBs have undefined schemas",
          "location": "franchiseManager.ts",
          "impact": "Only populated by import/migration"
        },
        {
          "id": "PL15-BUG-03",
          "description": "currentSeason/totalSeasons hardcoded to 1",
          "location": "franchiseManager.ts:235-243",
          "impact": "Always shows Season 1 of 1"
        }
      ]
    },
    {
      "id": "PL-FM",
      "name": "Fan Morale",
      "status": "BROKEN",
      "severity": "CRITICAL",
      "junctions": 13,
      "entryPoint": "fanMoraleEngine.ts (1358 lines)",
      "exitPoint": "useFanMorale hook (STUBBED)",
      "bugs": [
        {
          "id": "PLFM-BUG-01",
          "description": "Hook is STUBBED — comment says 'written with incorrect assumptions'",
          "location": "src/src_figma/app/hooks/useFanMorale.ts:7-12",
          "impact": "Full engine never exercises"
        },
        {
          "id": "PLFM-BUG-02",
          "description": "No persistence — morale in useState only, lost on refresh",
          "location": "src/src_figma/app/hooks/useFanMorale.ts",
          "impact": "Morale state ephemeral"
        },
        {
          "id": "PLFM-BUG-03",
          "description": "No game-result feeding — nothing calls processGameResult at game end",
          "location": "GameTracker.tsx:187",
          "impact": "Morale never changes from games"
        },
        {
          "id": "PLFM-BUG-04",
          "description": "Two different useFanMorale hooks exist (Figma + legacy)",
          "location": "src/src_figma/app/hooks/ vs src/hooks/",
          "impact": "Different APIs, both partially broken"
        }
      ]
    }
  ],
  "systemicIssues": [
    {
      "id": "SYS-01",
      "name": "No Duplicate Aggregation Guard",
      "description": "aggregateGameToSeason is purely additive. markGameAggregated flag exists but is never checked before aggregating. Stats double if called twice.",
      "affectedPipelines": ["PL-02", "PL-03", "PL-04", "PL-05", "PL-08"]
    },
    {
      "id": "SYS-02",
      "name": "Database Fragmentation",
      "description": "5+ separate IndexedDB databases with no cross-DB referential integrity. Schedule completion doesn't feed standings. Division structure from leagueBuilder ignored by standings and playoffs.",
      "affectedPipelines": ["PL-11", "PL-12", "PL-13", "PL-14", "PL-15"]
    },
    {
      "id": "SYS-03",
      "name": "Placeholder Identity Data",
      "description": "Multiple locations use playerId as playerName and awayTeamId for all players.",
      "locations": [
        "useGameState.ts:2868",
        "seasonAggregator.ts:304-305",
        "milestoneAggregator.ts:722-723"
      ]
    },
    {
      "id": "SYS-04",
      "name": "Type Safety Gaps",
      "description": "Figma useSeasonStats accesses WAR fields that don't exist on season types. useWARCalculations uses 'as any' casts. convertBattingStats drops SB/CS.",
      "locations": [
        "src/src_figma/app/hooks/useSeasonStats.ts:130-134",
        "src/src_figma/app/hooks/useWARCalculations.ts:135-136,227,252"
      ]
    }
  ],
  "crossPipelineGaps": [
    {
      "id": "XGAP-01",
      "description": "Schedule completion does NOT feed standings — different databases",
      "from": "PL-12",
      "to": "PL-13"
    },
    {
      "id": "XGAP-02",
      "description": "Franchise-per-database architecture orphaned from actual data systems",
      "from": "PL-15",
      "to": "PL-02,PL-03,PL-13"
    },
    {
      "id": "XGAP-03",
      "description": "Division/conference structure in leagueBuilder ignored by standings and playoffs",
      "from": "PL-11",
      "to": "PL-13,PL-14"
    },
    {
      "id": "XGAP-04",
      "description": "No game-result feeding into fan morale",
      "from": "PL-01",
      "to": "PL-FM"
    },
    {
      "id": "XGAP-05",
      "description": "Milestone fame events not pushed to UI notification system",
      "from": "PL-10",
      "to": "UI"
    }
  ],
  "totalBugs": 28,
  "bugsBySeverity": {
    "CRITICAL": 4,
    "HIGH": 10,
    "MED": 8,
    "LOW": 6
  }
}
